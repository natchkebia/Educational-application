<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>რეგისტრაცია</title>
    <link rel="stylesheet" href="../styles/styles.css" />
    <link rel="stylesheet" href="../styles/responsive.css" />
    <link rel="icon" href="../images/logo/header-logo.svg" />
  </head>
  <body>
    <div class="autorization">
      <div class="autorization__img">
        <img src="../images/autorization/tsereteli.png" alt="Akaki Tsereteli Quote" />
      </div>
      <div class="autorization__container">
        <header class="autorization__header">
          <div class="header__logo">
            <a class="header__logo--link" href="../index.html" class="logo">
              <img src="../images/logo/logo2final-01-01.png" alt="Skillup logo" />
            </a>
          </div>
          <div class="backto">
            <button class="arrow-btn" onclick="history.back()" title="goBack">
              <svg width="7" height="14" viewBox="0 0 7 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 13L1 7L6 1" stroke="" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg>
            </button>
          </div>
        </header>

        <main class="autorization__main">
          <section class="autorization-box">
            <div class="form--wrapper">
              <div class="registration form-box">
                <h2 class="title">რეგისტრაცია</h2>
                <p class="desc">ახალი ანგარიშის შესაქმნელად, გაიარე რეგისტრაცია</p>

                <form name="registration" id="registration-form">
                  <div class="username">
                    <!-- სახელი -->
                    <div class="input-box">
                      <div class="input-wrapper">
                        <input
                          id="firstname"
                          type="text"
                          name="firstname"
                          class="input-box__input"
                          placeholder=" "
                          oninput="validateField('firstname')" />
                        <label class="input-box-label" for="firstname">სახელი</label>
                      </div>
                      <p class="error-message" id="error-firstname"></p>
                    </div>

                    <!-- გვარი -->
                    <div class="input-box">
                      <div class="input-wrapper">
                        <input
                          id="lastname"
                          type="text"
                          name="lastname"
                          class="input-box__input"
                          placeholder=" "
                          oninput="validateField('lastname')" />
                        <label class="input-box-label" for="lastname">გვარი</label>
                      </div>
                      <p class="error-message" id="error-lastname"></p>
                    </div>
                  </div>

                  <!-- ელ. ფოსტა -->
                  <div class="input-box">
                    <div class="input-wrapper">
                      <input
                        id="email"
                        name="email"
                        type="email"
                        class="input-box__input"
                        placeholder=" "
                        oninput="validateField('email')" />
                      <label class="input-box-label" for="email">ელ. ფოსტა</label>
                    </div>
                    <p class="error-message" id="error-email"></p>
                  </div>

                  <!-- ტელ. ნომერი -->
                  <div class="input-box">
                    <div class="input-wrapper">
                      <input
                        id="tel"
                        name="tel"
                        type="tel"
                        class="input-box__input"
                        placeholder=" "
                        oninput="validateField('tel')" />
                      <label class="input-box-label" for="tel">ტელ. ნომერი</label>
                    </div>
                    <p class="error-message" id="error-tel"></p>
                  </div>

                  <!-- პაროლი -->
                  <div class="input-box">
                    <div class="input-wrapper">
                      <input
                        id="password"
                        name="password"
                        class="input-box__input"
                        type="password"
                        placeholder=" "
                        oninput="validateField('password')" />
                      <label class="input-box-label" for="password">პაროლი</label>
                      <img
                        src="../images/autorization/eyeclose.svg"
                        id="toggle-password"
                        class="eye-icon"
                        alt="Toggle Password Visibility"
                        onclick="togglePasswordVisibility('password', 'toggle-password')" />
                    </div>
                    <p class="error-message" id="error-password"></p>
                  </div>

                  <!-- გაიმეორე პაროლი -->
                  <div class="input-box">
                    <div class="input-wrapper">
                      <input
                        id="passwConfirm"
                        name="passwConfirm"
                        class="input-box__input"
                        type="password"
                        placeholder=" "
                        oninput="validateField('passwConfirm')" />
                      <label class="input-box-label" for="passwConfirm">გაიმეორე პაროლი</label>
                      <img
                        src="../images/autorization/eyeclose.svg"
                        id="toggle-passwConfirm"
                        class="eye-icon"
                        alt="Toggle Password Visibility"
                        onclick="togglePasswordVisibility('passwConfirm', 'toggle-passwConfirm')" />
                    </div>
                    <p class="error-message" id="error-passwConfirm"></p>
                  </div>
                  <span class="terms">ღილაკზე დაჭერით თქვენ ეთანხმებით SkillUp-ის <u><b>პოლიტიკას</b></u></span>

                  <button type="submit" class="btn" id="signInbtn">რეგისტრაცია</button>

                  <div class="registracion__social">
                    <span class="continue">ან გააგრძელე როგორც</span>
                    <div class="social__btns">
                      <button type="button" class="btn">
                        <object data="../images/autorization/gmail.svg"></object>
                        Google-ით გაგრძელება
                      </button>
                      <button type="button" class="btn">
                        <object data="../images/autorization/fb.svg"></object>
                        Facebook-ით გაგრძელება
                      </button>
                    </div>
                    <div class="login-register">
                      <p class="login-register-content">
                        უკვე გაქვს ანგარიში? გაიარე <a href="./logIn.html" class="login-link">ავტორიზაცია</a>
                      </p>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>

    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
      import { getDatabase } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";
      import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBWXkUmUmCZmmATIsQfcdBTszFhOu-IkiM",
        authDomain: "eduapp-775ab.firebaseapp.com",
        databaseURL: "https://eduapp-775ab-default-rtdb.firebaseio.com",
        projectId: "eduapp-775ab",
        storageBucket: "eduapp-775ab.appspot.com",
        messagingSenderId: "420498752186",
        appId: "1:420498752186:web:58dbdc330a7c27db563883",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const auth = getAuth();

      // Event listener for form submission
      document.getElementById("signInbtn").addEventListener("click", (e) => {
        e.preventDefault(); // Prevent form from submitting

        let email = document.getElementById("email").value;
        let password = document.getElementById("password").value;
        let passwConfirm = document.getElementById("passwConfirm").value;

        // Simple validation
        if (password !== passwConfirm) {
          alert("Passwords do not match!");
          return;
        }

        createUserWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            // Signed up
            const user = userCredential.user;
            alert("Registration successful!"); // Add any additional user information storage if needed
          })
          .catch((error) => {
            const errorMessage = error.message;
            alert(errorMessage);
          });
      });

      // Validate individual fields
      function validateField(fieldId) {
        let errors = {};
        const field = document.getElementById(fieldId);
        const value = field.value.trim();
        let errorElement = document.getElementById("error-" + fieldId);

        switch (fieldId) {
          case "firstname":
            if (!value) {
              errors.firstname = "აუცილებელია სახელი.";
            } else if (value.length < 2) {
              errors.firstname = "სახელი უნდა შეიცავდეს მინიმუმ 2 სიმბოლოს.";
            }
            break;
          case "lastname":
            if (!value) {
              errors.lastname = "აუცილებელია გვარი.";
            } else if (value.length < 2) {
              errors.lastname = "გვარი უნდა შეიცავდეს მინიმუმ 2 სიმბოლოს.";
            }
            break;
          case "email":
            const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (!value) {
              errors.email = "აუცილებელია ელ. ფოსტა.";
            } else if (!emailPattern.test(value)) {
              errors.email = "არასწორი ელ. ფოსტა.";
            }
            break;
          case "tel":
            const telPattern = /^[0-9]{9}$/;
            if (!value) {
              errors.tel = "აუცილებელია ტელ. ნომერი.";
            } else if (!telPattern.test(value)) {
              errors.tel = "ტელ. ნომერი უნდა იყოს 9 სიმბოლო.";
            }
            break;
          case "password":
            if (!value) {
              errors.password = "აუცილებელია პაროლი.";
            } else if (value.length < 6) {
              errors.password = "პაროლი უნდა შეიცავდეს მინიმუმ 6 სიმბოლოს.";
            }
            break;
          case "passwConfirm":
            const password = document.getElementById("password").value.trim();
            if (!value) {
              errors.passwConfirm = "გთხოვთ გაიმეოროთ პაროლი.";
            } else if (value !== password) {
              errors.passwConfirm = "პაროლები არ ემთხვევა.";
            }
            break;
          default:
            break;
        }

        if (Object.keys(errors).length > 0) {
          errorElement.textContent = errors[fieldId];
          errorElement.classList.add("show-icon");
        } else {
          errorElement.textContent = "";
          errorElement.classList.remove("show-icon");
        }
      }

      // Toggle password visibility
      function togglePasswordVisibility(inputId, iconId) {
        const inputField = document.getElementById(inputId);
        const icon = document.getElementById(iconId);
        if (inputField.type === "password") {
          inputField.type = "text";
          icon.src = "../images/autorization/eyeopen.svg";
        } else {
          inputField.type = "password";
          icon.src = "../images/autorization/eyeclose.svg";
        }
      }
    </script>
  </body>
</html>
